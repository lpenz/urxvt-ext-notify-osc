---
language: generic
addons: { apt: { packages: [ qemu-user-static ] } }
env:
  - OS=debian   DIST=buster ARCH=amd64
  - OS=raspbian DIST=buster ARCH=armhf
install: docker pull lpenz/${OS}-${DIST}-${ARCH}
script:
  - docker run -d --name debian -v "$PWD/..:$PWD/.." "lpenz/${OS}-${DIST}-${ARCH}" sleep 9999999999
  - docker exec -t debian /bin/bash -c "apt-get update && apt-get install -y --no-install-recommends devscripts equivs git-buildpackage"
  - docker exec -t debian /bin/bash -c "mk-build-deps -i -r --tool='apt-get -o Debug::pkgProblemResolver=yes --no-install-recommends --yes' $PWD/debian/control"
  - docker exec -t debian /bin/bash -c "cd $PWD && gbp buildpackage --git-ignore-branch -us -uc"
  - docker rm -f debian
  - sudo chown -R "$USER:$USER" ../
  - ls -l ..
deploy:
  provider: packagecloud
  username: lpenz
  repository: "$OS"
  token:
    secure: aetem2wqvKIptfa8q4xZZQXFMe8QwhrfKAEUqKivAV/C6TOrwibTKNa4n+3kQ/4M32TLOFZomxThP65GCd+S5IdHEBLKi3mQhYDaGhrc5PEzVBZdr3iALeYD5VZwf89nqz/mEbLBu1qp9Y3fn0T7XmN2zUikmCEf5+J2TeQJrVAk0RnlzZVYpuKrUxOueZhkqxUFr2Bo4wZEjIo5mBHuDhIRdogcMapyqHG5NwbfBJ3bJEYFHCoD2xAbIG3jFNfx7fTPhzIwjZkpPfn1pZgsFt4qOsg7oJDErEpfbqJTs8UGNwpRLCgNDDAKJsmf8qWz7pVNaYMDnGWs5UDwJZGT6W3Qpyis5jBH3x1M12HeG/l7wDY+/KhCsiwXncyMY8LSG84vfbJnXv9iDLFTptZV0465aCJMyeo+ctf8+Qz4UGma3ce5xu36a+Uk4dJZqGkt3Vjjo9Kv1GiOvLApQS18XCnRuhP1BAiP+k7jkQjPRcQwRh8QcjI+uZeY32f2E3VZuMUjEWBaLglj9hj79pJnV7mqRSk96V3Ze8x8asdk3YBdoaRiYjJs+3Xljk6c7eHpoxaFXT3NKSj31kr2cLKejBUceMoVn88/NEHCgcazAMFZpNZmY1NupXZQ4a2DQpp7kStiTfJ9wVY5HGsU3eqBYKZJrShEGWg9L+td8OrHO6E=
  dist: "$OS/$DIST"
  local-dir: ".."
  package_glob: "*.deb"
  on:
    branch: debian-debian
    tags: true
